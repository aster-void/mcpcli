# AGENTS.md

このリポジトリで作業するエージェント向けの指針。破壊的操作や挙動の曖昧さを避け、明示的な失敗とシンプルな手順を優先する。

## プロジェクト概要

- Node.js + pnpm 製の MCP CLI。`mcpcli connect <command...>` でサーバーを起動し対話、`mcpcli run "tool" <command...>` で 1 回実行。
- 終了コードは README 記載のポリシーに従い、利用者エラーと接続系エラーを明確に分ける。

## ディレクトリ構成（ディレクトリのみ）

```
.
├─ src/      # TypeScript 実装
├─ dist/     # ビルド済み JS 出力
├─ bin/      # CLI ラッパー配置想定
├─ scripts/  # 開発・検証用スクリプト
└─ nix/      # devshell など Nix 設定
```

## 最優先原則

- 失敗は明示する: エラーを握りつぶさない。`|| true` で黙殺しない。`if pkgs ? foo` での握りつぶしを避ける。
- 作業前にプランを立てる: 調査 → プラン提示 → 承認の順で進める。
- 破壊的操作前の確認: y/n で承認を得てから実行する（ユーザー指示に `--yes` がある場合のみ例外）。
- 一度に 1 原因だけ修正: 原因を特定し、1 件ずつ解消して再実行する。
- 迂回しない: 最初の計画が失敗したら次の計画を提示し、確認を取ってから動く。

## 基本フロー

1. ビルドまたは動作確認
2. バグの原因を探し、修正
3. ビルドまたは動作確認

## 開発コマンド

```sh
pnpm install
pnpm run build
pnpm test
```

## Nix / Flake 注意

- 新規ファイルは `git add -N path` しないと flake から見えない場合がある。例: `git add packages/foo.nix -N` の上で `nix run .#foo` を行う。

## コーディング/変更方針

- コードは自己説明的に、必要最小限のコメントのみ。
- 暗黙のデフォルトより明示的な引数・エラー処理を優先。
- 既存の挙動・終了コードポリシーを崩さないこと。

## リポジトリ固有コーディング指針

- src/index.ts はミニマルに保つ。
- `as` と `any`は絶対に許可されない。やったらマジでしばかれるから気をつけて
